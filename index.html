<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="http://yoursite.com">
  <title>My Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="年轻是一种资源，但不努力就浪费了。">
<meta property="og:type" content="website">
<meta property="og:title" content="My Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="My Blog">
<meta property="og:description" content="年轻是一种资源，但不努力就浪费了。">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="My Blog">
<meta name="twitter:description" content="年轻是一种资源，但不努力就浪费了。">
  
    <link rel="alternative" href="/atom.xml" title="My Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/assets/img/favicon.ico">
  
  <link rel="stylesheet" href="/main.css">
  

</head>

<body>
  <div id="container">
    <div class="left-col">
      <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img src="/images/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">高天</a></h1>
		</hgroup>

		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/">主页</a></li>
	        
				<li><a href="/photos">相册</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
	        
    		
    			
    			<a class="js-smart-menu" data-idx="0" href="javascript:void(0)">所有文章</a>
    			
    			
            
    			
    			<a class="js-smart-menu" data-idx="1" href="javascript:void(0)">标签</a>
    			
    			
            
    			
            
    			
    			<a class="js-smart-menu" data-idx="2" href="javascript:void(0)">关于我</a>
    			
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/gaotianhd" title="github">github</a>
		        
					<a class="CSDN" target="_blank" href="http://blog.csdn.net/gaotianhd" title="CSDN">CSDN</a>
		        
					<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"><i class="icon-list"></i></div>
  		<h1 class="header-author js-mobile-header hide">高天</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img src="/images/avatar.png" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">高天</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/photos">相册</a></li>
		        
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/gaotianhd" title="github">github</a>
			        
						<a class="CSDN" target="_blank" href="http://blog.csdn.net/gaotianhd" title="CSDN">CSDN</a>
			        
						<a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
        
  
    <article id="post-wangluo" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/03/wangluo/">python网络编程</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="osi模型：从上到下分别是应用层，表示层，会话层，传输层，网络层，链路层，物理层。"><a href="#osi模型：从上到下分别是应用层，表示层，会话层，传输层，网络层，链路层，物理层。" class="headerlink" title="osi模型：从上到下分别是应用层，表示层，会话层，传输层，网络层，链路层，物理层。"></a><code>osi模型：从上到下分别是应用层，表示层，会话层，传输层，网络层，链路层，物理层。</code></h2><p>物理层：提供为建立、维护和拆除物理链路所需要的机械的、电气的、功能的和规程的特性；有关的物理链路上传输非结构的位流以及故障检测指示。</p>
<p>数据链路层：在网络层实体间提供数据发送和接收的功能和过程；提供数据链路的流控。</p>
<p>网络层：控制分组传送系统的操作、路由选择、拥护控制、网络互连等功能，它的作用是将具体的物理传送对高层透明。</p>
<p>传输层：提供建立、维护和拆除传送连接的功能；选择网络层提供最合适的服务；在系统之间提供可靠的透明的数据传送，提供端到端的错误恢复和流量控制。</p>
<p>会话层：提供两进程之间建立、维护和结束会话连接的功能；提供交互会话的管理功能，如三种数据流方向的控制，即一路交互、两路交替和两路同时会话模式 。</p>
<p>表示层：代表应用进程协商数据表示；完成数据转换、格式化和文本压缩。</p>
<p>应用层：提供OSI用户服务，例如事务处理程序、文件传送协议和网络管理等。</p>
<hr>
<p>协议：协议(networking protocol)，网络协议的简称，网络协议是通信计算机双方必须共同遵从的一组约定。如怎么样建立连接、怎么样互相识别等。只有遵守这个约定，计算机之间才能相互通信交流。它的三要素是：语法、语义、时序。</p>
<hr>
<p>TCP/IP协议：TCP/IP协议，Transmission Control Protocol/Internet Protocol的简写，中译名为传输控制协议/因特网互联协议，又名网络通讯协议，是Internet最基本的协议、Internet国际互联网络的基 础，由网络层的IP协议和传输层的TCP协议组成。TCP/IP 定义了电子设备如何连入因特网，以及数据如何在它们之间传输的标准。协议采用了4层的层级结构，每一层都呼叫它的下一层所提供的协议来完成自己的需求。<code>而实际上我们现在所说的TCP/IP 协议有时想表达的是tcp/ip协议簇</code>，这是一组常用的协议。</p>
<h1 id="socket套接字："><a href="#socket套接字：" class="headerlink" title="socket套接字："></a>socket套接字：</h1><p>Socket套接字分为以下几种：</p>
<p>流式套接字(SOCK_STREAM)<br><code>提供了一个面向连接、可靠的数据传输服务，数据无差错、无重复的发送且按发送顺序接收。</code>内设置流量控制，避免数据流淹没慢的接收方。数据被看作是字节流，无长度限制。</p>
<p>数据报套接字(SOCK_DGRAM)</p>
<p><code>提供无连接服务。数据包以独立数据包的形式被发送，不提供无差错保证，数据可能丢失或重复，顺序发送，可能乱序接收。</code></p>
<p>原始套接字(SOCK_RAW)</p>
<p>可以对较低层次协议如IP、ICMP直接访问。</p>
<p>使用协议，IP，端口号来发消息</p>
<p>字节序：小端序：低字节存储在低地址<br>       大端序：高序字节存储在低地址</p>
<p>inet_aton(‘ip’)将IP地址转化为网络字节序地址。</p>
<p>inet_ntoa(‘网络地址’)还原</p>
<p>htons(端口号)将端口号转化为网络端口号</p>
<p>ntohs()还原</p>
<hr>
<h2 id="使用socket-模块创建套接字"><a href="#使用socket-模块创建套接字" class="headerlink" title="使用socket()模块创建套接字"></a>使用socket()模块创建套接字</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">socket(socket_family, socket_type, protocol=<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p>socket_family 可以是 AF_UNIX 或 AF_INET。socket_type 可以是 SOCK_STREAM 或 SOCK_DGRAM。这几个常量的意义可以参考之前的解释。protocol 一般不填，默认值为 0。 创建一个 TCP/IP 的套接字，你要这样调用 socket.socket()：</p>
<p>tcpSock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</p>
<p>服务器端套接字函数：<br><code>s.bind()        绑定地址（主机，端口号对）到套接字</code><br><code>s.listen()      开始 TCP 监听</code><br><code>s.accept()      被动接受 TCP 客户的连接， （阻塞式）等待连接的到来</code></p>
<p>客户端套接字函数：<br><code>s.connect()     主动初始化 TCP 服务器连接</code></p>
<p>公共用途的套接字函数：<br><code>s.recv()        接收 TCP 数据</code><br><code>s.send()        发送 TCP 数据</code><br>s.sendall()     完整发送 TCP 数据<br><code>s.recvfrom()    接收 UDP 数据</code><br><code>s.sendto()      发送 UDP 数据</code><br><code>s.getpeername() 连接到当前套接字的远端的地址</code><br>s.getsockname() 当前套接字的地址<br>s.getsockopt()  返回指定套接字的参数<br>s.setsockopt()  设置指定套接字的参数<br><code>s.close()       关闭套接字</code></p>
<h1 id="TCP（即传输控制协议）："><a href="#TCP（即传输控制协议）：" class="headerlink" title="TCP（即传输控制协议）："></a>TCP（即传输控制协议）：</h1><p><code>是一种面向连接的传输层协议，它能提供高可靠性通信(即数据无误、数据无丢失、数据无失序、数据无重复到达的通信)</code><br>适用情况：<code>适合于对传输质量要求较高，以及传输大量数据的通信。在需要可靠数据传输的场合，</code>通常使用TCP协议MSN/QQ等即时通讯软件的用户登录账户管理相关的功能通常采用TCP协议。</p>
<hr>
<p>TCP编写服务器端和客户端：</p>
<p>服务器端：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</div><div class="line">HOST = <span class="string">'192.168.1.247'</span></div><div class="line">PORT = <span class="number">5858</span></div><div class="line">BUFSIZE = <span class="number">1024</span></div><div class="line">ADDR = (HOST,PORT)</div><div class="line">sockfd = socket(AF_INET,SOCK_STREAM)</div><div class="line">sockfd.bind(ADDR)</div><div class="line">sockfd.listen(<span class="number">5</span>)<span class="comment">#同时可以有多少个监听在等待，就像打电话似的，通话过程中再有电话会等待。超过5个后会拒绝</span></div><div class="line"><span class="keyword">print</span> <span class="string">"waiting for connection......"</span></div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    connfd,addr = sockfd.accept()<span class="comment">#连接一个就在等待队列里面减少一个，返回值是两个,第一个是一个新的套接字</span></div><div class="line">    <span class="comment">#sockfd是用在本程序的一些操作，比如bind等等。connd是用来和用户进行联系，addr同时接受到了ip地址</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"connected from :"</span>,addr</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        data = connfd.recv(BUFSIZE)<span class="comment">#一次接收的最大字节数</span></div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">            <span class="keyword">break</span></div><div class="line">        connfd.send(<span class="string">"[%s] : %s"</span>%(ctime(),data))</div><div class="line">sockfd.close()</div><div class="line">connfd.close()</div></pre></td></tr></table></figure></p>
<p>分析：定义访问的ip地址，端口号。地址是由ip地址和端口号组成的元组。定义流式套接字。绑定地址，设置监听。accept()是用来连接客户端的，会返回一个用于和客户端交换信息的新的套接字，和用户端的地址信息。一个recv对应客户端一个send，一个send对应客户端的recv。<br>客户端：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> sys</div><div class="line">HOST = sys.argv[<span class="number">1</span>]</div><div class="line">PORT = int(sys.argv[<span class="number">2</span>])</div><div class="line">BUFSIZE = <span class="number">1024</span></div><div class="line">ADDR = (HOST,PORT)</div><div class="line">sockfd = socket(AF_INET,SOCK_STREAM)</div><div class="line">sockfd.connect(ADDR)</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    data = raw_input(<span class="string">'&gt;'</span>)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">        <span class="keyword">break</span></div><div class="line">    sockfd.send(data)</div><div class="line">    data = sockfd.recv(BUFSIZE)</div><div class="line">    <span class="keyword">print</span> data</div><div class="line">sockfd.close()</div></pre></td></tr></table></figure></p>
<p>分析：动态的从终端输入ip和端口号，向服务器端传值send，接收服务器端值recv。</p>
<hr>
<h1 id="UDP（User-Datagram-Protocol）用户数据报协议"><a href="#UDP（User-Datagram-Protocol）用户数据报协议" class="headerlink" title="UDP（User Datagram Protocol）用户数据报协议:"></a>UDP（User Datagram Protocol）用户数据报协议:</h1><p><code>是不可靠的无连接的协议。在数据发送前，因为不需要进行连接，所以可以进行高效率的数据传输。</code><br>适用情况：发送小尺寸数据（如对DNS服务器进行IP地址查询时）在接收到数据，给出应答较困难的网络中使用UDP。（如：无线网络）适合于广播/ 组播式通信中。MSN/QQ/Skype等即时通讯软件的点对点文本通讯以及音视频通讯通常采用UDP协议。流媒体、VOD、VoIP、IPTV等网络多 媒体服务中通常采用UDP方式进行实时数据传输。</p>
<p>UDP编写服务器端和客户端：</p>
<p>服务器端：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</div><div class="line">HOST = <span class="string">'192.168.1.247'</span></div><div class="line">PORT = <span class="number">5858</span></div><div class="line">BUFSIZE = <span class="number">1024</span></div><div class="line">ADDR = (HOST,PORT)</div><div class="line">sockfd = socket(AF_INET,SOCK_DGRAM)</div><div class="line">sockfd.bind(ADDR)</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    <span class="keyword">print</span> <span class="string">"waiting for message"</span></div><div class="line">    data,addr = sockfd.recvfrom(BUFSIZE)</div><div class="line">    <span class="keyword">print</span> <span class="string">"client addr : "</span>,addr</div><div class="line">    <span class="keyword">print</span> <span class="string">"client data : "</span>,data</div><div class="line">    sockfd.sendto(<span class="string">'[%s : %s]'</span>%(ctime(),data),addr)</div><div class="line"></div><div class="line">sockfd.close()</div></pre></td></tr></table></figure></p>
<p>分析：到绑定地址同理。UDP不需要accept直接就可以使用recvfrom和sendto进行信息传递。recvfrom返回值是数据和地址信息，sendto参数也是数据和地址信息。</p>
<p>客户端：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> sys</div><div class="line">HOST = sys.argv[<span class="number">1</span>]</div><div class="line">PORT = int(sys.argv[<span class="number">2</span>])</div><div class="line">BUFSIZE = <span class="number">1024</span></div><div class="line">ADDR = (HOST,PORT)</div><div class="line">sockfd = socket(AF_INET,SOCK_DGRAM)</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    data = raw_input(<span class="string">'&gt;'</span>)</div><div class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">        <span class="keyword">break</span></div><div class="line">    sockfd.sendto(data,ADDR)</div><div class="line">    data,ADDR = sockfd.recvfrom(BUFSIZE)</div><div class="line">    <span class="keyword">print</span> data</div><div class="line">sockfd.close()</div></pre></td></tr></table></figure></p>
<p>分析：动态从终端接收ip和端口号。用sendto向服务器端传值，用recvfrom接收服务器端的值（注：从终端输入的的都是字符串，所以端口号要强转）</p>
<hr>
<h1 id="使用ftp实现文件服务器："><a href="#使用ftp实现文件服务器：" class="headerlink" title="使用ftp实现文件服务器："></a>使用ftp实现文件服务器：</h1><p>服务器端代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">server</span>:</span></div><div class="line">    BUFSIZE = <span class="number">1024</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,sockfd)</span>:</span></div><div class="line">        self.sockfd = sockfd</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_list</span><span class="params">(self)</span>:</span></div><div class="line">        filelist = os.listdir(<span class="string">'.'</span>)</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> filelist:</div><div class="line">            self.sockfd.send(i)</div><div class="line">            sleep(<span class="number">0.1</span>)</div><div class="line">        <span class="keyword">print</span> <span class="string">"list ok!"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">download</span><span class="params">(self,filename)</span>:</span></div><div class="line">        f = open(filename,<span class="string">'r'</span>)</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            data = f.readline()</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">                <span class="keyword">break</span></div><div class="line">            self.sockfd.send(data)</div><div class="line">            sleep(<span class="number">0.1</span>)</div><div class="line">        f.close()</div><div class="line">        <span class="keyword">print</span> <span class="string">"download ok!"</span></div><div class="line">        <span class="keyword">return</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(self,filename)</span>:</span></div><div class="line">        f = open(filename,<span class="string">'w'</span>)</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            data = self.sockfd.recv(self.BUFSIZE)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">                <span class="keyword">break</span></div><div class="line">            f.write(data)</div><div class="line">        f.close()</div><div class="line">        <span class="keyword">print</span> <span class="string">"upload ok!"</span></div><div class="line">        <span class="keyword">return</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">3</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"input valid arg"</span></div><div class="line">        sys.exit(<span class="number">0</span>)</div><div class="line">    HOST = sys.argv[<span class="number">1</span>]</div><div class="line">    PORT = int(sys.argv[<span class="number">2</span>])</div><div class="line">    BUFSIZE = <span class="number">1024</span></div><div class="line">    ADDR = (HOST,PORT)</div><div class="line">    sockfd = socket(AF_INET,SOCK_STREAM)</div><div class="line">    sockfd.bind(ADDR)</div><div class="line">    sockfd.listen(<span class="number">5</span>)</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        connfd,addr = sockfd.accept()</div><div class="line">        <span class="keyword">print</span> <span class="string">"connected from :"</span>,addr</div><div class="line">        data = connfd.recv(BUFSIZE)</div><div class="line">        ftp = server(connfd)</div><div class="line">        <span class="keyword">print</span> <span class="string">"----"</span>,data</div><div class="line">        <span class="keyword">if</span> data[<span class="number">0</span>] == <span class="string">'L'</span>:</div><div class="line">            ftp.do_list()</div><div class="line">        <span class="keyword">if</span> data[<span class="number">0</span>] == <span class="string">'D'</span>:</div><div class="line">            ftp.download(data[<span class="number">2</span>:])</div><div class="line">        <span class="keyword">if</span> data[<span class="number">0</span>] == <span class="string">'U'</span>:</div><div class="line">            ftp.upload(data[<span class="number">2</span>:])</div><div class="line">        connfd.close()</div><div class="line">    sys.exit(<span class="number">0</span>)</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure></p>
<p>客户端代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">import</span> os</div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> *</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">client</span>:</span></div><div class="line">    BUFSIZE = <span class="number">1024</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,serveraddr)</span>:</span></div><div class="line">        self.serveraddr = serveraddr</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">do_list</span><span class="params">(self)</span>:</span></div><div class="line">        data = <span class="string">'L'</span></div><div class="line">        sockfd = socket(AF_INET,SOCK_STREAM)</div><div class="line">        sockfd.connect(self.serveraddr)</div><div class="line">        sockfd.send(data)</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            data = sockfd.recv(self.BUFSIZE)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">                <span class="keyword">break</span></div><div class="line">            <span class="keyword">print</span> <span class="string">"%s"</span>%data</div><div class="line">        <span class="keyword">print</span> <span class="string">"list ok!"</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">download</span><span class="params">(self,filename)</span>:</span></div><div class="line">        f = open(filename,<span class="string">'w'</span>)</div><div class="line">        data = <span class="string">'D '</span>+filename</div><div class="line">        sockfd = socket(AF_INET,SOCK_STREAM)</div><div class="line">        sockfd.connect(self.serveraddr)</div><div class="line">        sockfd.send(data)</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            data = sockfd.recv(self.BUFSIZE)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">                <span class="keyword">break</span></div><div class="line">            f.write(data)</div><div class="line">        <span class="keyword">print</span> <span class="string">"download ok!"</span></div><div class="line">        sockfd.close()</div><div class="line">        f.close()</div><div class="line">        <span class="keyword">return</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(self,filename)</span>:</span></div><div class="line">        f = open(filename,<span class="string">'r'</span>)</div><div class="line">        <span class="keyword">print</span> filename</div><div class="line">        data1 = <span class="string">'U '</span>+filename</div><div class="line">        sockfd = socket(AF_INET,SOCK_STREAM,<span class="number">0</span>)</div><div class="line">        sockfd.connect(self.serveraddr)</div><div class="line">        sockfd.send(data1)</div><div class="line">	       sleep(<span class="number">0.1</span>)</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            data = f.readline()</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">                <span class="keyword">break</span></div><div class="line">            sockfd.send(data)</div><div class="line">        <span class="keyword">print</span> <span class="string">"uplaod ok!"</span>,filename</div><div class="line">        sockfd.close()</div><div class="line">        f.close()</div><div class="line">        <span class="keyword">return</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">3</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"error"</span></div><div class="line">        sys.exit(<span class="number">0</span>)</div><div class="line">    HOST = sys.argv[<span class="number">1</span>]</div><div class="line">    PORT = int(sys.argv[<span class="number">2</span>])</div><div class="line">    ADDR = (HOST,PORT)</div><div class="line">    ftp = client(ADDR)</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">"---list---"</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"---download---"</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"---upload---"</span></div><div class="line">        <span class="keyword">print</span> <span class="string">"---quit---"</span></div><div class="line">        data = raw_input(<span class="string">'&gt;'</span>)</div><div class="line">        <span class="keyword">if</span> data[<span class="number">0</span>] == <span class="string">"l"</span>:</div><div class="line">            ftp.do_list()</div><div class="line">        <span class="keyword">elif</span> data[<span class="number">0</span>] == <span class="string">"d"</span>:</div><div class="line">            ftp.download(data[<span class="number">9</span>:])</div><div class="line">        <span class="keyword">elif</span> data[<span class="number">0</span>] == <span class="string">"u"</span>:</div><div class="line">            ftp.upload(data[<span class="number">7</span>:])</div><div class="line">        <span class="keyword">elif</span> data[<span class="number">0</span>] == <span class="string">"q"</span>:</div><div class="line">            sys.exit(<span class="number">0</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">    sys.exit(<span class="number">0</span>)</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure></p>
<p>分析：主要完成文件显示，文件上传，文件下载，具体实现看代码。</p>
<h1 id="IO-模型"><a href="#IO-模型" class="headerlink" title="IO 模型"></a>IO 模型</h1><p>在UNIX/Linux下主要的I/O 模型有：阻塞I/O,非阻塞I/O,异步I/O等。下面一一介绍下每种IO模型的特点。</p>
<h1 id="阻塞IO"><a href="#阻塞IO" class="headerlink" title="阻塞IO"></a>阻塞IO</h1><p>在linux中，默认情况下所有的socket都是blocking。当用户进程调用了recv，kernel就开始了IO的第一个阶段：准备数据。对于网络IO来说，很多时候数据在一开始还没有到达（比如，还没有收到一个完整的数据包），这个时候kernel就要等待足够的数据到来。而在用户进程这边，整个进程会被阻塞。当kernel一直等到数据准备好了，它就会将数据从kernel中拷贝到用户内存，然后kernel返回结果，用户进程才解除block的状态，重新运行起来。所以，blocking IO的特点就是在IO执行的两个阶段（等待数据和拷贝数据两个阶段）都被阻塞了。几乎所有的程序员第一次接触到的网络编程都是从listen()、 send()、recv()等接口开始的，这些接口都是阻塞型的。使用这些接口可以很方便的构建服务器/客户机的模型。因此阻塞IO是最常用、最简单、效率最低的。</p>
<h1 id="非阻塞IO"><a href="#非阻塞IO" class="headerlink" title="非阻塞IO"></a>非阻塞IO</h1><p>Linux下，可以通过设置socket使其变为non-blocking。当对一个non-blocking socket执行读操作时。当用户进程发出read操作时，如果kernel中的数据还没有准备好，那么它并不会block用户进程，而是立刻返回一个 error。从用户进程角度讲 ，它发起一个read操作后，并不需要等待，而是马上就得到了一个结果。用户进程判断结果是一个error时，它就知道数据还没有准备好，于是它可以再次 发送read操作。一旦kernel中的数据准备好了，并且又再次收到了用户进程的system call，那么它马上就将数据拷贝到了用户内存，然后返回。所以，在非阻塞式IO中，用户进程其实是需要不断的主动询问kernel数据准备好了没有。非 阻塞的接口相比于阻塞型接口的显著差异在于，在被调用之后立即返回。使用一定的函数可以将某句柄fd设为非阻塞状态。非阻塞IO可防止进程阻塞在I/O操 作上，但是需要轮询耗费资源较多<br>服务器端：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        sockfd = socket(AF_INET,SOCK_STREAM)</div><div class="line">        sockfd.bind((<span class="string">'192.168.1.247'</span>,<span class="number">5858</span>))</div><div class="line">        sockfd.listen(<span class="number">5</span>)</div><div class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</div><div class="line">        <span class="keyword">print</span> <span class="string">"error"</span></div><div class="line">        exit(<span class="number">0</span>)</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        sockfd.setblocking(<span class="number">1</span>)</div><div class="line">        connfd,addr = sockfd.accept()</div><div class="line">        buf = connfd.recv(<span class="number">1024</span>)</div><div class="line">        connfd.close()</div><div class="line">        <span class="keyword">print</span> <span class="string">"-----"</span></div><div class="line"><span class="keyword">if</span> __name__ ==<span class="string">"__main__"</span>:</div><div class="line">    start()</div></pre></td></tr></table></figure></p>
<p>客户端：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="comment">#coding=utf-8</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">client</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        sockfd = socket(AF_INET,SOCK_STREAM)</div><div class="line">        sockfd.connect((<span class="string">'192.168.1.247'</span>,<span class="number">5858</span>))</div><div class="line">        <span class="keyword">print</span> <span class="string">"输入字符"</span></div><div class="line">        buf = raw_input()</div><div class="line">        <span class="keyword">if</span> buf == <span class="string">''</span>:</div><div class="line">            <span class="keyword">break</span></div><div class="line">        sockfd.send(buf)</div><div class="line">        <span class="keyword">print</span> sockfd.recv(<span class="number">1024</span>)</div><div class="line">        sockfd.close()</div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</div><div class="line">    client()</div></pre></td></tr></table></figure></p>
<h1 id="异步IO"><a href="#异步IO" class="headerlink" title="异步IO"></a>异步IO</h1><p>实际上同步与异步是针对应用程序与内核的交互而言的。同步过程中进程触发IO操作并等待或者轮询的去查看IO操作是否完成。异步过程中进程触发IO 操作以后，直接返回，做自己的事情，IO交给内核来处理，完成后内核通知进程IO完成。Python的异步I/O支持是相当的好。有一堆库可以做这个工 作。在这其中select/poll是较为常见的异步IO实现模式。虽然有些说法称这种IO多路复用实际也是轮询而不是真正的异步，但是这并不影响我们现 阶段的理解和学习。</p>
<h2 id="select实现异步IO"><a href="#select实现异步IO" class="headerlink" title="select实现异步IO"></a>select实现异步IO</h2><p>Python中的select模块以列表形式接受四个参数，原型为：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">select(rlist,wlist,xlist[,timeout])</div></pre></td></tr></table></figure></p>
<p>其中rlist是等待读取的对象，wlist是等待写入的对象，xlist是等待异常的对象，最后一个是可选对象，指定等待的时间。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> select <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</div><div class="line">HOST = <span class="string">'192.168.1.247'</span></div><div class="line">PORT = <span class="number">5858</span></div><div class="line">BUFSIZE = <span class="number">1024</span></div><div class="line">ADDR = (HOST,PORT)</div><div class="line">sockfd = socket(AF_INET,SOCK_STREAM,<span class="number">0</span>)</div><div class="line">sockfd.bind(ADDR)</div><div class="line">sockfd.listen(<span class="number">5</span>)</div><div class="line">inputs = [sockfd]</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    rs,ws,es = select(inputs,[],[])</div><div class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> rs:</div><div class="line">        <span class="keyword">if</span> r <span class="keyword">is</span> sockfd:</div><div class="line">            connfd,addr = sockfd.accept()</div><div class="line">            <span class="keyword">print</span> <span class="string">"connect from :"</span>,addr</div><div class="line">            inputs.append(connfd)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">try</span>:</div><div class="line">                data = r.recv(BUFSIZE)</div><div class="line">                disconnect = <span class="keyword">not</span> data</div><div class="line">            <span class="keyword">except</span> sockt.error:</div><div class="line">                disconnect = <span class="keyword">True</span></div><div class="line">            <span class="keyword">if</span> disconnect:</div><div class="line">                <span class="keyword">print</span> r.getpeername(),<span class="string">'disconnected'</span></div><div class="line">                inputs.remove(r)</div><div class="line">                r.close()</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                r.send(<span class="string">'[%s] :%s'</span>%(ctime(),data))</div><div class="line">sockfd.close()</div></pre></td></tr></table></figure></p>
<p>分析：select函数返回一个读列表，里面放的都是准备好的套接字。循环遍历rs。</p>
<hr>
<h2 id="poll实现异步IO"><a href="#poll实现异步IO" class="headerlink" title="poll实现异步IO"></a>poll实现异步IO</h2><p>poll实现服务器时，需要用到register()和unregister()方法，作用是加入和移除对象，poll()的返回值包括了文件描述 符和事件，polling的事件常量有POLLIN，POLLPRI，POLLPOUT，POLLERR，POLLHUP，POLLVAL，分别表示读取 数据，读取紧急数据，文件描述符已经准备好，文件描述符出错，连接丢失，无效请求。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> select <span class="keyword">import</span> *</div><div class="line">s = socket()</div><div class="line">host = <span class="string">'192.168.1.247'</span></div><div class="line">port = <span class="number">5858</span></div><div class="line">s.bind((host,port))</div><div class="line">fdmap = &#123;s.fileno():s&#125;</div><div class="line">s.listen(<span class="number">5</span>)</div><div class="line">p = poll()</div><div class="line">p.register(s)</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    events = p.poll()</div><div class="line">    <span class="keyword">for</span> fd,event <span class="keyword">in</span> events:</div><div class="line">        <span class="keyword">if</span> fd == s.fileno():</div><div class="line">            c,addr = s.accept()</div><div class="line">            <span class="keyword">print</span> <span class="string">"got connection fron "</span>,addr</div><div class="line">            p.register(c)</div><div class="line">            fdmap[c.fileno()] = c</div><div class="line">        <span class="keyword">elif</span> event &amp; POLLIN:</div><div class="line">            data = fdmap[fd].recv(<span class="number">1024</span>)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">                <span class="keyword">print</span> fdmap[fd].getpeername(),<span class="string">'disconnected'</span></div><div class="line">                p.unregister(fd)</div><div class="line">                <span class="keyword">del</span> fdmap[fd]</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">print</span> data</div><div class="line">                fdmap[fd].send(<span class="string">'receive message'</span>)</div><div class="line">s.close()</div></pre></td></tr></table></figure></p>
<p>分析：先将套接字s注册，生成一个poll函数对象，调用poll函数返回一个文件描述符和事件。fileno函数是将套接字转换为文件描述符。event&amp;POLLIN是按位相与，匹配上为True。</p>
<hr>
<h1 id="循环服务器"><a href="#循环服务器" class="headerlink" title="循环服务器"></a>循环服务器</h1><p>循环服务器采用UDP模式较多，TCP很少有采用循环服务器的。大体流程是：</p>
<p>服务器端运行后等待客户端的连接请求。</p>
<p>服务器接受一个客户端的连接后开始处理，完成了客户的所有请求后断开连接。</p>
<p>循环服务器一次只能处理一个客户端的请求。</p>
<p>只有在当前客户的所有请求都完成后，服务器才能处理下一个客户的连接/服务请求。</p>
<p>如果某个客户端一直占用服务器资源，那么其它的客户端都不能被处理。</p>
<h1 id="并发服务器"><a href="#并发服务器" class="headerlink" title="并发服务器"></a>并发服务器</h1><p>为了弥补循环服务器的缺陷，人们又设计了并发服务器的模型。并发服务器的设计思想是服务器接受客户端的连接请求后采用多进程或者多线程的方法来为客 户端服务 TCP并发服务器可以避免TCP循环服务器中客户端独占服务器的情况。在并发服务器中大多采用TCP的模式。另外还有一种方式就是采取异步IO的方式实现 并发服务器。这就是我们上面讲到的select/poll的方法。</p>
<h1 id="多进程实现并发服务器："><a href="#多进程实现并发服务器：" class="headerlink" title="多进程实现并发服务器："></a>多进程实现并发服务器：</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="keyword">import</span> socket,traceback,os,sys</div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">reap</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            result = os.waitpid(<span class="number">-1</span>,os.WHOHANG)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> result[<span class="number">0</span>]:<span class="keyword">break</span></div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            <span class="keyword">break</span></div><div class="line">        <span class="keyword">print</span> <span class="string">'reaped child process %d'</span>%result[<span class="number">0</span>]</div><div class="line">host = <span class="string">''</span></div><div class="line">port = <span class="number">5858</span></div><div class="line">s = socket.socket()</div><div class="line">s.bind((host,port))</div><div class="line">s.listen(<span class="number">5</span>)</div><div class="line"><span class="keyword">print</span> <span class="string">'parent at %d listen for connections'</span>%os.getpid()</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        c,addr = s.accept()</div><div class="line">    <span class="keyword">except</span> KeyboardInterrupt:</div><div class="line">        <span class="keyword">raise</span></div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        traceback.print_exc()</div><div class="line">        <span class="keyword">continue</span></div><div class="line">    reap()</div><div class="line">    pid = os.fork()</div><div class="line">    <span class="keyword">if</span> pid:</div><div class="line">        c.close()</div><div class="line">        <span class="keyword">continue</span></div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        s.close()</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">print</span> <span class="string">"child from %s being hanled PID %d"</span>%(c.getpeername(),os.getpid())</div><div class="line">            <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">                data = c.recv(<span class="number">1024</span>)</div><div class="line">                <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">                    <span class="keyword">break</span></div><div class="line">                <span class="keyword">print</span> data</div><div class="line">                c.send(<span class="string">'recv your message'</span>)</div><div class="line">        <span class="keyword">except</span> (KeyboardInterrupt,SystemExit):</div><div class="line">            <span class="keyword">raise</span></div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            traceback.print_exc()</div><div class="line">        c.close()</div><div class="line">        sys.exit(<span class="number">0</span>)</div></pre></td></tr></table></figure>
<p>分析：用fork函数创建进程，父进程关闭客户端套接字。子进程关闭父进程套接字。每有一个客户端接入就创建一个子进程与之通信，父进程就是用来创建子进程的。</p>
<hr>
<h1 id="多线程实现并发服务器："><a href="#多线程实现并发服务器：" class="headerlink" title="多线程实现并发服务器："></a>多线程实现并发服务器：</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="keyword">import</span> socket,os,sys,traceback</div><div class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> *</div><div class="line">host = <span class="string">'192.168.1.247'</span></div><div class="line">port = <span class="number">5858</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">handler</span><span class="params">(clientsock)</span>:</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'new child'</span></div><div class="line">    <span class="keyword">print</span> <span class="string">'go connection from'</span>,clientsock.getpeername()</div><div class="line">    <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">        data = clientsock.recv(<span class="number">1024</span>)</div><div class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">            <span class="keyword">break</span></div><div class="line">        clientsock.send(<span class="string">'receive your message'</span>)</div><div class="line">    clientsock.close()</div><div class="line">s = socket.socket()</div><div class="line">s.bind((host,port))</div><div class="line">s.listen(<span class="number">5</span>)</div><div class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        clientsock,clientaddr = s.accept()</div><div class="line">    <span class="keyword">except</span> KeyboardInterrupt:</div><div class="line">        <span class="keyword">raise</span></div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        traceback.print_exc()</div><div class="line">        <span class="keyword">continue</span></div><div class="line">    t = Thread(target = handler,args = (clientsock,))</div><div class="line">    t.setDaemon(<span class="number">1</span>)</div><div class="line">    t.start()</div><div class="line">s.close()</div></pre></td></tr></table></figure>
<p>分析：每有一个客户端接入创建一个线程，并将客户端套接字传入子线程中，用线程和客户端进行通信。</p>
<hr>
<h1 id="集成模块："><a href="#集成模块：" class="headerlink" title="集成模块："></a>集成模块：</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#! /usr/bin/python</span></div><div class="line"><span class="keyword">from</span> SocketServer <span class="keyword">import</span> *</div><div class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Server</span><span class="params">(ForkingMixIn,TCPServer)</span>:</span></div><div class="line">    <span class="keyword">pass</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span><span class="params">(StreamRequestHandler)</span>:</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span><span class="params">(self)</span>:</span></div><div class="line">        addr = self.request.getpeername()</div><div class="line">        <span class="keyword">print</span> <span class="string">'got connection from'</span>,addr</div><div class="line">        <span class="keyword">while</span> <span class="keyword">True</span>:</div><div class="line">            data = self.request.recv(<span class="number">1024</span>)</div><div class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</div><div class="line">                <span class="keyword">break</span></div><div class="line">            self.request.send(<span class="string">'[%s] :%s'</span>%(ctime(),data))</div><div class="line">server = Server((<span class="string">'192.168.1.247'</span>,<span class="number">5858</span>),Handler)</div><div class="line">server.serve_forever()</div></pre></td></tr></table></figure>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/11/03/wangluo/" class="archive-article-date">
  	<time datetime="2016-11-03T09:48:37.914Z" itemprop="datePublished"><i class="icon-clock"></i>2016-11-03</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-song" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/03/song/">My Song List</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="530" height="350" src="http://music.163.com/outchain/player?type=0&id=475310048&auto=0&height=430"></iframe>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/11/03/song/" class="archive-article-date">
  	<time datetime="2016-11-03T09:48:37.913Z" itemprop="datePublished"><i class="icon-clock"></i>2016-11-03</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-first" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/03/first/">First MarkDown File</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="this-is-my-first-markdown-file-2"><a href="#this-is-my-first-markdown-file-2" class="headerlink" title="this is my first markdown file.2"></a>this is my first markdown file.2</h1><h2 id="this-is-second-title"><a href="#this-is-second-title" class="headerlink" title="this is second title."></a>this is second title.</h2><h3 id="this-is-third-title"><a href="#this-is-third-title" class="headerlink" title="this is third title."></a>this is third title.</h3><h4 id="this-is-fourth-title"><a href="#this-is-fourth-title" class="headerlink" title="this is fourth title."></a>this is fourth title.</h4><h5 id="this-is-fifth-title"><a href="#this-is-fifth-title" class="headerlink" title="this is fifth title."></a>this is fifth title.</h5><h6 id="this-is-sixth-title"><a href="#this-is-sixth-title" class="headerlink" title="this is sixth title."></a>this is sixth title.</h6><p><em>this text will be italic</em><br><br><em>this text also be italic</em><br><br><strong>this text will be bold</strong><br><br><strong>this text also be bold</strong><br><br><del>this text will be delete</del><br><br><em>you <strong>can</strong> combine them</em><br></p>
<ul>
<li>first</li>
<li>second</li>
</ul>
<ul>
<li>third</li>
</ul>
<ol>
<li>first</li>
<li>second</li>
<li>third</li>
</ol>
<p>-[x] FInsh my changes<br><br>-[ ] Push my commits to GitHub<br><br>-[ ] Open a pull request<br></p>
<p><a href="http://github.com" target="_blank" rel="external">github</a><br></p>
<p><code>############</code><br></p>
<p>:smile:<br><br>:grinning:<br></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">print</span> <span class="string">"123"</span>;</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>标题</th>
<th>内容</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>今天</td>
<td>很热</td>
<td>少穿</td>
</tr>
<tr>
<td>昨天</td>
<td>下雨</td>
<td>打伞</td>
</tr>
</tbody>
</table>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/11/03/first/" class="archive-article-date">
  	<time datetime="2016-11-03T09:48:37.912Z" itemprop="datePublished"><i class="icon-clock"></i>2016-11-03</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/03/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/11/03/hello-world/" class="archive-article-date">
  	<time datetime="2016-11-03T09:48:37.911Z" itemprop="datePublished"><i class="icon-clock"></i>2016-11-03</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
    <article id="post-database" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/03/database/">python连接mysql数据库</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>数据 ：能够输入计算机并能被计算机程序识别和处理的信息集合。</p>
<p>数据库（Database）：是按照数据结构来组织、存储和管理数据的仓库。数据库是在数据库管理系统管理和控制之下，存放在存储介质上的数据集合。</p>
<p>数据库管理系统：数据库管理系统是一种操纵和管理数据库的大型软件，用于建立、使用和维护数据库，简称DBMS。它对数据库进行统一的管理 和控制，以保证数据库的安全性和完整性。一般支持数据库定义功能，数据库操纵功能，数据库运行控制功能，数据通信功能，支持存取海量数据等</p>
<p>数据库系统（DBS）：它和数据库不是一个概念，数据库系统比数据库大的多，由数据库、数据库管理系统、应用开发工具构成。常见的数据库系统：甲骨文的Oracle、IBM的DB2、微软的SQLServer、开源的MySQL等。</p>
<p>##MySql数据库的安装<br>并不是所有的系统自来就有mysql，如果你想使用mysql数据库需要进行安装。下面以ubuntu为例进行安装，如果是windows下可以去Oracle的mysql官方页面下载自己喜欢的版本安装。最近的版本已经是5.6版本。<br><a href="http://www.mysql.com/%20mysql%E5%AE%98%E7%BD%91" target="_blank" rel="external">mysql官网</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1． Sudo apt-get update</div><div class="line"></div><div class="line">2． Sudo apt-get install mysql-server</div></pre></td></tr></table></figure>
<p>安装过程会自动弹出配置界面</p>
<p>安装mysql的服务端后，可以对数据库进行后端操作。还可以安装个客户端用来访问数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install mysql-client</div></pre></td></tr></table></figure>
<p>安装完成后通过mysql –u root -p 然后输入密码可以进入数据库了。</p>
<p>如果想用python对mysql数据库进行操作不像sqlite那么简单，还需要安装python的MySQLdb 进行支持，实际这是一个接口程序，没安装前导入模块失败。</p>
<p>MySQLdb可以通过源码安装或者apt-get直接安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install python-mysqldb</div></pre></td></tr></table></figure>
<p>安装以后可以在python中导入MySQLdb模块，如果导入成功基本就没有什么问题了。安装过程会有一些自动的路径搜索，如果你的操作系统中不同目录下安装了很多不同版本那么可能只有一个能用，需要你进行配置。当然安装方法还有很多，只要最终能够达到目的就可以了。</p>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><p>help : 查看命令帮助</p>
<p>quit 或 exit： 退出mysql操作</p>
<p>show databases ： 显示数据库文件列表</p>
<p>use [database]：打开数据库</p>
<p>show tables ：显示数据库中所有表名</p>
<p>desc <figure class="highlight plain"><figcaption><span>查看表的结构</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">在sql中关键字是不区分大小写的，操作内容区分大小写。</div><div class="line"></div><div class="line">### 语句主要可以分为以下三类</div><div class="line">DDL语句（数据定义）</div><div class="line">这些语句定义了不同的数据段、数据库、表、列、索引等数据库对象。常用的关键字包括create、drop、alter等</div><div class="line"></div><div class="line">DML语句（数据操纵）</div><div class="line">用于添加、删除、更新和查询数据记录，并检查数据完整性。常用关键字包括insert、delete、update、和select的等。</div><div class="line"></div><div class="line">DCL语句（数据控制）</div><div class="line"></div><div class="line">用于控制不同数据段直接的许可和访问级别的语句。这些语句定义了数据库、表、字段、用户的访问权限和安全级别。主要的语句关键字有grant、revoke等。</div><div class="line"></div><div class="line">### sql数据定义</div><div class="line">创建一个数据库</div><div class="line"></div><div class="line">create database [databasename]</div><div class="line"></div><div class="line">创建后MySql在linux下默认的数据文件存储目录为/var/lib/mysql</div><div class="line"></div><div class="line">删除一个数据库</div><div class="line"></div><div class="line">drop database [databasename]</div><div class="line"></div><div class="line">创建一个表：</div><div class="line"></div><div class="line">create table tabname(col1 type1 [not null] [primary key],col2 type2 [not null],..)</div><div class="line"></div><div class="line">这个命令中tabname为表名后面col为字段名称，type1为字段数据类型，后面是约束条件。</div></pre></td></tr></table></figure></p>
<p>runoob_tbl(<br>   runoob_id INT NOT NULL AUTO_INCREMENT,<br>   runoob_title VARCHAR(100) NOT NULL,<br>   runoob_author VARCHAR(40) NOT NULL,<br>   submission_date DATE,<br>   PRIMARY KEY ( runoob_id )<br>);<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div></pre></td><td class="code"><pre><div class="line">如果你不想字段为NULL可以设置字段的属性为NOT NULL，在操作数据库时如果输入该字段的数据为NULL，就会报错。</div><div class="line"></div><div class="line">AUTO_INCREMENT定义列为自增的属性，一般用于主键，数值会自动加1。</div><div class="line"></div><div class="line">PRIMARY KEY关键字用于定义列为主键。可以使用多列来定义主键，列间以逗号分隔。</div><div class="line">删除一个表：</div><div class="line"></div><div class="line">drop table [table_name]</div><div class="line"></div><div class="line">修改数据表字段类型</div><div class="line"></div><div class="line">alter table [tablename] modify [field] [new_type] [first | after]</div><div class="line"></div><div class="line">增加表字段</div><div class="line"></div><div class="line">alter table [tablename] add column ([field] [type], ...) [first | after]</div><div class="line"></div><div class="line">删除表字段</div><div class="line"></div><div class="line">alter table [tablename] drop column [field];</div><div class="line"></div><div class="line">字段改名</div><div class="line"></div><div class="line">alter table [tablename] change &lt;old_field&gt; &lt;new_field&gt; [type] [first | after]</div><div class="line"></div><div class="line">修改默认值</div><div class="line"></div><div class="line">ALTER TABLE [tablename] ALTER [field] SET DEFAULT 1000;</div><div class="line"></div><div class="line">ALTER TABLE [tablename] ALTER [field] DROP DEFAULT;</div><div class="line"></div><div class="line">更改表名</div><div class="line"></div><div class="line">alter table [tablename] rename [to] [new_tablename]</div><div class="line"></div><div class="line">### sql数据操作</div><div class="line">插入记录</div><div class="line"></div><div class="line">insert into [table_name] (field1,field2....) values (value1, value2,…);</div><div class="line"></div><div class="line">如果不指定类型那么默认需要按照表的字段顺序来写值</div><div class="line"></div><div class="line">更新记录</div><div class="line"></div><div class="line">update [table_name] set [f1=value1], [f2=value2] … where [expression];</div><div class="line"></div><div class="line">删除记录</div><div class="line"></div><div class="line">delete from [table_name] where [expression]</div><div class="line"></div><div class="line">查询记录</div><div class="line"></div><div class="line">select * from [table_name] where [expression]</div><div class="line"></div><div class="line">“*”代表所有记录，也可以用都好分割的方式选定字段来代替。</div><div class="line"></div><div class="line">条件查询</div><div class="line"></div><div class="line">select * from [table_name] where [expression]</div><div class="line"></div><div class="line">在条件中可以使用个= &gt; &lt; &gt;= &lt;= != 等比较运算符，还可以使用and，or等逻辑运算符。</div><div class="line"></div><div class="line">like也可以进行字符串比较, &apos;%&apos; 代表多个字符,   &apos;_&apos;代表一个字符。</div><div class="line">### Mysql的python数据库接口</div><div class="line">mysqldb</div><div class="line"></div><div class="line">#### 建立连接</div><div class="line">要与数据库进行通信, 必须先和数据库建立连接。连接对象处理命令如何送往服务器, 以及如 何从服务器接收数据等基础功能。连接成功(或一个连接池)后你就能够向数据库服务器发送请求, 得到响应。</div><div class="line">####常用方法</div><div class="line">connect()              创建数据库连接</div><div class="line">close()                关闭数据库连接</div><div class="line">commit()               提交当前事务</div><div class="line">rollback()             取消当前事务</div><div class="line">cursor()               使用这个连接创建并返回一个游标或类游标的对象</div><div class="line"></div><div class="line">connect()调用：注意不是所有的接口程序都是严格按照规范实现的。MySQLdb 就使用了 db 参 数而不是规范推荐的 database 参数来表示要访问的数据库。</div><div class="line">一旦执行了close()方法，再试图使用连接对象的方法将会导致异常。对不支持事务的数据库或者虽然支持事务，但设置了自动提交(auto- commit)的数据库系统来说，commit()方法什么也不做。如果你确实需要，可以实现一个自定义方法来关闭自动提交行为。由于 DB-API 要求必须实现此方法，对那些没有事务概念的数据库来说，这个方法只需要有一条pass语句就可以了。类似 commit()，rollback()方法仅对支持事务的数据库有意义。执行完 rollback()，数据库将恢复到提交事务前的状态。根据 PEP249，在提交 commit()之前关闭数据库连接将会自动调用rollback()方法。对不支持游标的数据库来说,  cursor()方法仍然会返回一个尽量模仿游标对象的对象。这些是最低要求。特定数据库接口程序的开发者可以任意为他们的接口程序添加额外的属性，只要 他们愿意。DB-API 规范建议但不强制接口程序的开发者为所有数据库接口模块编写异常类。如果没有提供异常类，则假定该连接对象会引发一致的模块级异常。一旦你完成了数据库连 接，并且关闭了游标对象，你应该执行 commit() 提交你的操作，然后关闭这个连接。</div><div class="line">### 游标对象操作</div><div class="line">当你建立连接之后，就可以与数据库进行交互。我们提交一个游标允许用户执行数据库命令和得到查询结果。一个 Python DB-API 游标对象总是扮演游标的角色, 无论数据库是否真正支持游标。从这一点讲, 数据库接口程序必须实现游标对象。只有这样，才能保证无论使用何种后端数据库你的代码都不需要做任何改变。创建游标对象之后，你就可以执行查询或其它命令 (或者多个查询和多个命令), 也可以从结果集中取出一条或多条记录。</div><div class="line">#### 游标属性和方法</div><div class="line">arraysize 使用 fechmany()方法一次取出多少条记录, 默认值为 1</div><div class="line">connectionn 创建此游标对象的连接(可选)</div><div class="line">description 返回游标活动状态(一个包含七个元素的元组): (name, type_code,display_size, internal_ size, precision, scale, null_ok); 只有 name 和 type_code 是必须提供的</div><div class="line">lastrowid 返回最后更新行的 id (可选), 如果数据库不支持行 id, 默认返回 None)</div><div class="line">rowcount 最后一次 execute() 操作返回或影响的行数</div><div class="line">callproc(func[,args]) 调用一个存储过程</div><div class="line">**close() 关闭游标对象**</div><div class="line">**execute(op[,args]) 执行一个数据库查询或命令**</div><div class="line">executemany(op,args) 类似 execute() 和 map() 的结合, 为给定的每一个参数准备并执行一个数据库查询/命令</div><div class="line">**fetchone() 得到结果集的下一行**</div><div class="line">**fetchmany([size=cursor.arraysize]) 得到结果集的下几行 (几 = size)**</div><div class="line">**fetchall() 返回结果集中剩下的所有行**</div><div class="line">__iter__() 创建一个迭代对象 (可选; 参阅 next())</div><div class="line">messages 游标执行后数据库返回的信息列表 (元组集合) (可选)</div><div class="line">next() 使用迭代对象得到结果集的下一行(可选; 类似 fetchone(), 参阅 __iter__())</div><div class="line">nextset() 移到下一个结果集 (如果支持的话)</div><div class="line">rownumber 当前结果集中游标的索引 (以行为单位, 从 0 开始) (可选)</div><div class="line">setinput- sizes(sizes) 设置输入最大值 (必须有, 但具体实现是可选的)</div><div class="line">setoutput- size(size[,col]) 设置大列的缓冲区大写(必须有, 但具体实现是可选的)</div><div class="line"></div><div class="line">在这众多游标对象中最重要的属性是 execute() 和 fetch()方法。所有对数据库服务器的请求都由它们来完成。对 fetchmany()方法来说, 设置一个合理的 arraysize属性会很有用。当然，在不需要时关掉游标对象也是个好主意</div><div class="line"></div><div class="line">#### python使用mysql数据库的一些基本操作</div></pre></td></tr></table></figure></p>
<p>#! /usr/bin/python</p>
<p>#coding=utf-8<br>import MySQLdb</p>
<p>#打开数据库连接<br>db = MySQLdb.connect(‘localhost’,’root’,’5560442’,’testdb’)</p>
<p>#创建游标，用来通过sql语句操作具体数据<br>cursor = db.cursor()</p>
<p>#通过游标对象执行sql语句<br>cursor.execute(“select age,sex from emp where name = ‘gt’”)<br>data = cursor.fetchone()<br>print data</p>
<p>#—————</p>
<p>#创建表</p>
<p>#cursor.execute(“drop table if exists newtab”)</p>
<p>#sql = “create table newtab(id int not null,name varchar(20),age int,income float)”</p>
<p>#cursor.execute(sql)</p>
<p>#—————<br>sql = “select * from newtab”<br>cursor.execute(sql)<br>id1 = cursor.fetchall()[0][0]#这个返回的是一个查询出来的结果组成元组<br>print id1<br>name = cursor.description[1][0]#返回一个由（每个属性的七个元素组成的元组）的元组，元组里面有元组<br>print name<br>for i in cursor.description:<br>    print i[0],<br>sql1 = “update newtab set name = ‘gt’ where id = ‘“+str(id1)+”‘“<br>try:<br>    cursor.execute(sql1)<br>    db.commit()<br>except:<br>    db.rollback()#回滚到执行前的状态<br>try:<br>    cursor.execute(“insert into qq values(‘“+id1+”‘,’”+name+”‘)”)<br>    db.commit()<br>except:<br>    db.rollback()<br>db.close()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#### 题目 ： 完成一个学生成绩管理系统</div><div class="line"></div><div class="line">实验要求 ：</div><div class="line"></div><div class="line">使用python和mysql数据库完成该实验</div><div class="line"></div><div class="line">基本功能应该包含学生信息和分数的增删改查操作</div><div class="line"></div><div class="line">自己创建数据库和表</div><div class="line"></div><div class="line">程序有简单的命令提示，代码具有一定的封装性和可扩建型</div><div class="line"></div><div class="line">#### 实现代码</div></pre></td></tr></table></figure>
<p>#! /usr/bin/python</p>
<p>#coding=utf-8<br>import MySQLdb<br>def insert(db):<br>    cursor = db.cursor()<br>    name = raw_input(“姓名：”)<br>    age = raw_input(“年龄：”)<br>    mark = raw_input(“成绩：”)<br>    try:<br>        sql = “insert into soure values(‘%s’,’%s’,’%s’)”%(name,age,mark)<br>        cursor.execute(sql)<br>        db.commit()<br>        print “插入成功！”<br>    except:<br>        print “插入失败！”<br>        db.rollback()<br>def select(db):<br>    cursor = db.cursor()<br>    sql = “select <em> from soure “<br>    cursor.execute(sql)<br>    for i in cursor.description:<br>        print i[0],<br>    print “”<br>    for row in cursor.fetchall():<br>        print row[0],row[1],row[2]<br>def selectone(db,name):<br>    cursor = db.cursor()<br>    sql = “select </em> from soure where name=’%s’”%name<br>    cursor.execute(sql)<br>    for i in cursor.description:<br>        print i[0],<br>    print “”<br>    for row in cursor.fetchall():<br>        print row[0],row[1],row[2]<br>def delete(db):<br>    cursor = db.cursor()<br>    sql = “select <em> from soure “<br>    cursor.execute(sql)<br>    for i in cursor.description:<br>        print i[0],<br>    print “”<br>    for row in cursor.fetchall():<br>        print row[0],row[1],row[2]<br>    name = raw_input(“输入要删除学生姓名：”)<br>    sql = “delete from soure where name=’%s’”%name<br>    try:<br>        cursor.execute(sql)<br>        db.commit()<br>        print “删除成功！”<br>    except:<br>        print “删除失败！”<br>        db.rollback()<br>def update(db):<br>    cursor = db.cursor()<br>    sql = “select </em> from soure “<br>    cursor.execute(sql)<br>    for i in cursor.description:<br>        print i[0],<br>    print “”<br>    for row in cursor.fetchall():<br>        print row[0],row[1],row[2]<br>    name = raw_input(“输入修改的学生姓名：”)<br>    mark = raw_input(“输入修改的成绩：”)<br>    sql = “update soure set mark = ‘%s’ where name = ‘%s’”%(mark,name)<br>    try:<br>        cursor.execute(sql)<br>        db.commit()<br>        print “修改成功！”<br>    except:<br>        print “修改失败！”<br>        bd.rollback()<br>def updateone(db,name):<br>    cursor = db.cursor()<br>    sql = “select * from soure where name=’%s’”%name<br>    cursor.execute(sql)<br>    for i in cursor.description:<br>        print i[0],<br>    print “”<br>    for row in cursor.fetchall():<br>        print row[0],row[1],row[2]<br>    age = raw_input(“要修改的年龄”)<br>    sql1 = “update soure set age = ‘%s’ where name = ‘%s’”%(age,name)<br>    try:<br>        cursor.execute(sql1)<br>        db.commit()<br>        print “修改成功！”<br>    except:<br>        print “修改失败！”<br>        db.rollback()<br>def updatepw(db,name):<br>    cursor = db.cursor()<br>    pas = raw_input(“输入旧密码：”)<br>    sql1 = “select password from users where password = ‘%s’”%(pas)<br>    cursor.execute(sql1)<br>    data = cursor.fetchone()<br>    if data != None:<br>        new_pas = raw_input(“新密码：”)<br>        new_pas1 = raw_input(“确认新密码：”)<br>        if new_pas == new_pas1:<br>            sql = “update users set password = ‘%s’ where username = ‘%s’”%(new_pas,name)<br>            try:<br>                cursor.execute(sql)<br>                db.commit()<br>                print “修改密码成功,请重新登陆！”<br>                return main()<br>            except:<br>                print “失败！”<br>                db.rollback()<br>def register(db,n,pw):<br>    cursor = db.cursor()<br>    sql2 = “select username from users where username = ‘%s’”%n<br>    cursor.execute(sql2)<br>    data = cursor.fetchone()<br>    if data == None:<br>        sql = “insert into users(username,password) values(‘%s’,’%s’)”%(n,pw)<br>        sql1 = “insert into soure(name) values(‘%s’)”%(n)<br>        try:<br>            cursor.execute(sql)<br>            cursor.execute(sql1)<br>            db.commit()<br>            print “注册成功！”<br>        except:<br>            print “register error”<br>            db.rollback()<br>    else:<br>        print “用户名已存在！”<br>        return main()<br>def main():<br>    db = MySQLdb.connect(‘localhost’,’root’,’5560442’,’student’)<br>    while True:<br>        print “——menu——“<br>        print “—-register—-“<br>        print “—-loginon—–”<br>        print “—-quit——–”<br>        order = raw_input(“&gt;&gt;&gt;”)<br>        if order == “register”:<br>            username = raw_input(“请输入用户名：”)<br>            password = raw_input(“请输入密码：”)<br>            register(db,username,password)<br>        elif order == “loginon”:<br>                loginname = raw_input(“请输入登陆名：”)<br>                loginpass = raw_input(“请输入密码：”)<br>                cursor = db.cursor()<br>                sql = “select username,password,biaozhi from users where username=’%s’ and password=’%s’”%(loginname,loginpass)<br>                try:<br>                    cursor.execute(sql)<br>                    data = cursor.fetchone()[2]<br>                    while True:<br>                        if data == 1:<br>                            print “–manager menu–”<br>                            print “—-1.select—-“<br>                            print “—-2.insert—-“<br>                            print “—-3.update—-“<br>                            print “—-4.delete—-“<br>                            print “—-5.quit——“<br>                            operate = raw_input(“输入操作对应的数字：”)<br>                            if operate == ‘1’:<br>                                select(db)<br>                            if operate == ‘2’:<br>                                insert(db)<br>                            if operate == ‘3’:<br>                                update(db)<br>                            if operate == ‘4’:<br>                                delete(db)<br>                            if operate == ‘5’:<br>                                break<br>                        elif data == 0:<br>                            print “—user menu—“<br>                            print “—1.select—-“<br>                            print “—2.update—-“<br>                            print “—3.quit——“<br>                            operate = raw_input(“输入操作对应的数字：”)<br>                            if operate == ‘1’:<br>                                selectone(db,loginname)<br>                            if operate == ‘2’:<br>                                print “—1.update information—“<br>                                print “—2.update password—“<br>                                op = raw_input(“输入操作：”)<br>                                if op == ‘1’:<br>                                    updateone(db,loginname)<br>                                if op == ‘2’:<br>                                    updatepw(db,loginname)<br>                            if operate == ‘3’:<br>                                break<br>                        else:<br>                            break<br>                except:<br>                    print “登陆失败！”<br>                    db.rollback()<br>        elif order == ‘quit’:<br>            db.close()<br>            return<br>        else:<br>            continue<br>if <strong>name</strong> == ‘<strong>main</strong>‘:<br>    main()<br>```</p>

      
    </div>
    <div class="article-info article-info-index">
      
      <a href="/2016/11/03/database/" class="archive-article-date">
  	<time datetime="2016-11-03T09:48:37.907Z" itemprop="datePublished"><i class="icon-clock"></i>2016-11-03</time>
</a>
      
      

      <div class="clearfix"></div>
    </div>
  </div>
</article>










  
  


      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 高天
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    <script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: false,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		root: "/",
		innerArchive: true
	}
</script>

<script src="/./main.js"></script>


    
<div class="tools-col">
  <ul class="btn-wrap">
    
      <li class="chose" data-hook="tools-section-all"><span class="text">全部</span><i class="icon-book"></i></li>
    
    
      <li data-hook="tools-section-tag"><span class="text">标签</span><i class="icon-price-tags"></i></li>
    
    
    
      <li data-hook="tools-section-me"><span class="text">我</span><i class="icon-smile"></i></li>
    
  </ul>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all chose">
    	</section>
    

    
    	<section class="tools-section tools-section-tag">
    			<div class="widget tagcloud" id="js-tagcloud">
    				
    			</div>
    	</section>
    

    

    
    	<section class="tools-section tools-section-me">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">Litten，&lt;br&gt;毕业于华科，就职于鹅厂&lt;br&gt;&lt;br&gt;热爱大海与冷笑话，&lt;br/&gt;目前是一枚前端&lt;br/&gt;&lt;br/&gt;胆小认生，不易相处，&lt;br&gt;年轻无为，卖马为生。</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>